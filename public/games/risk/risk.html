<div ng-controller="RiskCtrl as ctrl" ng-init="ctrl.init()" class="risk-page">
<div class="risk-world-map">
  <img class="img-responsive risk-map-image" src="/games/risk/pictures/Simple_world_map.png">
  <div class="risk-grid">
    <div class="row risk-row" ng-repeat="row in ctrl.getRows()">
      <div class="col-xs-2 risk-section" ng-repeat="cellName in ctrl.getColumns(row)"
      ng-click="ctrl.showCell(cellName)" ng-style="ctrl.getCell(cellName).style"
      ng-class="{'currentCell': ctrl.currentCell.name == cellName, 'neighborCell': ctrl.isNeighbor(cellName)}">
        <span class="label" ng-if="ctrl.getCell(cellName).active"
          ng-class="{'label-default': ctrl.getCellDiplomacy(cellName) == 0, 'label-primary': ctrl.getCellDiplomacy(cellName) == 1, 'label-danger': ctrl.getCellDiplomacy(cellName) == -1}">
          {{cellName}}
        </span>
        <span class="visible-xs-inline pull-right" ng-if="ctrl.getCell(cellName).active">
          {{ctrl.getCell(cellName).troops}}
        </span>
        <span class="label label-pill hidden-xs troop-badge" ng-if="ctrl.getCell(cellName).active"
          ng-class="{'label-default': ctrl.getCellDiplomacy(cellName) == 0, 'label-primary': ctrl.getCellDiplomacy(cellName) == 1, 'label-danger': ctrl.getCellDiplomacy(cellName) == -1}">
          {{ctrl.getCell(cellName).troops}}
        </span>
      </div>
    </div>
  </div>
</div>

<div ng-show="loading" class="risk-element">
  <span>Loading..</span>
</div>

<div ng-show="!loading && !ctrl.currentCell" class="risk-element">
  <h3>Please select a cell</h3>
</div>

<div ng-show="ctrl.currentCell" class="risk-element">
  <div class="panel panel-info">
    <div class="panel-heading"><h3>{{ctrl.currentCell.name}} - {{ctrl.currentCell.description}}</h3></div>
    <div class="panel-body">
      <p ng-if="ctrl.cellWarning" class="text-warning"><span class="glyphicon glyphicon-warning-sign"></span> {{ctrl.cellWarning}}</p>
      <p>Owner: <strong>{{ctrl.currentCell.ownerName}}</strong></p>
      <p>Troops: <strong>{{ctrl.currentCell.troops}}</strong></p>
      <div ng-if="user.userLevel == 'admin'">
        <hr />
        <p><strong>Admin Controls:</strong></p>
        <p>Change Owner: </p>
        <p><select ng-options="player for player in ctrl.playerNames" ng-model="ctrl.playerChosen"></select></p>
        <p>Troops: </p>
        <p><input type="number" ng-model="ctrl.troopsAmount" value="0"></input></p>
        <button class="btn btn-primary" ng-disabled="ctrl.saving" ng-click="ctrl.updateCell()">Save</button> <span ng-if="ctrl.savingError" class="text-danger">{{ctrl.savingError}}</span>

      </div>
    </div>
  </div>
</div>

<div class="risk-element">
  <div class="panel panel-info">
    <div class="panel-heading"><h3>Players</h3></div>
    <div class="panel-body">
      <div class="table-responsive">
        <table class="table">
          <thead>
            <tr>
              <th></th>
              <th>User</th>
              <th>Cells Owned</th>
              <th>Daily Troops</th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="player in ctrl.players">
              <td ng-style="{'background-color': ctrl.hexToRGB(player.playerColor, 0.5)}"><img ng-src="{{player.picture}}" class="img img-thumbnail user-picture"></img></td>
              <td class="user-text">{{player.name}}</td>
              <td>{{ctrl.getCellsOwnedBy(player.id).length}}</td>
              <td>{{ctrl.getTroopDailyValue(player.id)}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<div class="risk-element" ng-init="attackers = 1; defenders = 1;">
  <div class="panel panel-info">
    <div class="panel-heading"><h3>Dice Roller</h3></div>
    <div class="panel-body">
      <div>
        <div class = "row">
          <div class="col-sm-3">
            <p>Attackers:</p>
            <p><input type="number" min="1" ng-model="attackers"/></p>
            <p>Defenders:</p>
            <p><input type="number" min="1" ng-model="defenders"/></p>
            <button class="btn btn-primary" ng-disabled="ctrl.saving" ng-click="battle = ctrl.battle(attackers, defenders)">Battle</button>
          </div>
          <div class="col-sm-3" ng-show="battle">
            <h3>Summary:</h3><br />
            <span class="text-success" ng-if="!battle.remainingDefenders">The attackers succeeded!<br/></span>
            <span class="text-danger" ng-if="!battle.remainingAttackers">The defenders defeated the attackers!<br/></span>
            <br />
            <span>Starting Attackers: {{battle.startingAttackers}}</span><br/>
            <span>Remaining Attackers: {{battle.remainingAttackers}}</span><br/>
            <br />
            <span>Starting Defenders: {{battle.startingDefenders}}</span><br/>
            <span>Remaining Defenders: {{battle.remainingDefenders}}</span><br/><br/>
          </div>
          <div class="col-sm-6" ng-show="battle">
            <h3>Rolls ({{battle.fights.length}}):</h3><br />
            <div ng-repeat="fight in battle.fights">
              <span>---- Roll {{fight.fightNumber}} ----</span><br/>
              <span>A: {{fight.attackingDice}} - Losses: {{fight.attackersLost}} - Remaining: {{fight.remainingAttackers}}</span><br/>
              <span>D: {{fight.defendingDice}} - Losses: {{fight.defendersLost}} - Remaining: {{fight.remainingDefenders}}</span><br/><br/>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</div>
